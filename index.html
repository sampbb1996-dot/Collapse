<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">

<meta name="viewport"
  content="width=device-width,
           height=device-height,
           initial-scale=1.0,
           maximum-scale=1.0,
           user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000000">

<title></title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;

  touch-action: none;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  caret-color: transparent;
  cursor: none;
  overscroll-behavior: none;
}

#field {
  position: fixed;
  inset: 0;
  background: #000;
  pointer-events: none;
}
</style>
</head>

<body>
<div id="field"></div>

<script>
/*
  LOGIC SUMMARY (DO NOT MODIFY):

  - Exactly ONE thumb must be down at all times
  - No resting / no 0-state
  - Event-gated replacement only
  - No alternation, no rhythm, no cadence
  - Action = replace thumb, not lift into void
*/

/* =========================
   INFO BLOB (STATE MIRROR)
   ========================= */

const infoBlob = {
  startedAt: Date.now(),
  activeTouchId: null,
  awaitingReplacement: false,
  lastEvent: null
};

function record(type) {
  infoBlob.lastEvent = {
    t: Date.now(),
    type
  };
}

/* ========================= */

let activeTouchId = null;
let awaitingReplacement = false;

function kill(e) {
  e.preventDefault();
}

document.addEventListener('touchstart', e => {
  kill(e);

  // Initial acquisition
  if (activeTouchId === null && e.touches.length === 1) {
    activeTouchId = e.touches[0].identifier;
    awaitingReplacement = false;

    infoBlob.activeTouchId = activeTouchId;
    infoBlob.awaitingReplacement = false;
    record("acquire");

    return;
  }

  // Replacement only when explicitly awaiting
  if (awaitingReplacement && e.touches.length === 2) {
    for (const t of e.touches) {
      if (t.identifier !== activeTouchId) {
        activeTouchId = t.identifier;
        awaitingReplacement = false;

        infoBlob.activeTouchId = activeTouchId;
        infoBlob.awaitingReplacement = false;
        record("replace");

        break;
      }
    }
  }
}, { passive: false });

document.addEventListener('touchmove', kill, { passive: false });

document.addEventListener('touchend', e => {
  kill(e);

  for (const t of e.changedTouches) {
    if (t.identifier === activeTouchId) {
      awaitingReplacement = true;

      infoBlob.awaitingReplacement = true;
      record("release");

      return;
    }
  }
}, { passive: false });

document.addEventListener('touchcancel', e => {
  kill(e);

  activeTouchId = null;
  awaitingReplacement = false;

  infoBlob.activeTouchId = null;
  infoBlob.awaitingReplacement = false;
  record("cancel");
}, { passive: false });

</script>
</body>
</html>
