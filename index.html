<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>State</title>
<style>
  html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: #181818;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #field {
    position: absolute;
    inset: 0;
    background: #181818;
  }

  #circle {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: #ff9f0a;
    opacity: 0;
  }
</style>
</head>
<body>

<div id="field"></div>
<div id="circle"></div>

<script>
let state = Math.random() < 0.5 ? 1 : 0;
let bias = 0;

const circle = document.getElementById("circle");

// --- AUDIO ---
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const osc = ctx.createOscillator();
const gain = ctx.createGain();

osc.type = "sine";
osc.frequency.value = 220;
gain.gain.value = 0;

osc.connect(gain);
gain.connect(ctx.destination);
osc.start();

// unlock audio on first touch
document.body.addEventListener("touchstart", () => {
  ctx.resume();
}, { once: true });

// --- EVOLUTION ---
function step() {
  // drift back toward 50/50 if nothing meaningful happens
  bias *= 0.98;

  const p = 0.5 + bias;
  state = Math.random() < p ? 1 : 0;

  // visual
  circle.style.opacity = state;

  // audio
  gain.gain.setTargetAtTime(state ? 0.15 : 0, ctx.currentTime, 0.05);

  // slow, steady evolution
  setTimeout(step, 600);
}

// --- INPUT ---
document.body.addEventListener("touchstart", () => {
  // input slightly counteracts decay but adds noise
  bias += (Math.random() - 0.5) * 0.1;
});

step();
</script>

</body>
</html>
