<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bound Noise</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #2b2b2b;
    overflow: hidden;
    touch-action: manipulation;
  }

  canvas {
    display: block;
  }

  #audioBtn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 22px;
    font-size: 16px;
    border-radius: 20px;
    border: none;
    background: #ff9800;
    color: #111;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>
<button id="audioBtn">Enable Audio</button>

<script>
/* ---------- canvas ---------- */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

/* ---------- state ---------- */
let intensity = 0.5;        // baseline 50/50
const decay = 0.002;        // slow return to baseline
let audioEnabled = false;

/* ---------- audio ---------- */
let audioCtx, noiseNode, gainNode;

function initAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const bufferSize = audioCtx.sampleRate;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);

  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }

  noiseNode = audioCtx.createBufferSource();
  noiseNode.buffer = buffer;
  noiseNode.loop = true;

  gainNode = audioCtx.createGain();
  gainNode.gain.value = 0;

  noiseNode.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  noiseNode.start();
}

/* ---------- input ---------- */
document.getElementById('audioBtn').onclick = () => {
  if (!audioEnabled) {
    initAudio();
    audioEnabled = true;
    document.getElementById('audioBtn').remove();
  }
};

document.body.addEventListener('pointerdown', () => {
  if (!audioEnabled) return;
  intensity = Math.min(1, intensity + 0.08);
});

/* ---------- render loop ---------- */
function draw() {
  // decay toward baseline
  if (intensity > 0.5) intensity -= decay;
  if (intensity < 0.5) intensity += decay;

  // audio follows intensity
  if (audioEnabled) {
    gainNode.gain.value = intensity * 0.25;
  }

  // draw noise
  const img = ctx.createImageData(canvas.width, canvas.height);
  const d = img.data;

  for (let i = 0; i < d.length; i += 4) {
    const n = (Math.random() * intensity) * 255;
    d[i]     = 255;          // orange
    d[i + 1] = 152 + n * 0.2;
    d[i + 2] = 0;
    d[i + 3] = 255;
  }

  ctx.putImageData(img, 0, 0);
  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
