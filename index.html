<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, sans-serif;
  -webkit-text-size-adjust: 100%;
}

#zone {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

#value {
  font-size: 4rem;
  font-variant-numeric: tabular-nums;
  pointer-events: none;
}

#reset {
  position: fixed;
  bottom: 16px;
  left: 16px;
  right: 16px;
  padding: 16px;
  border-radius: 999px;
  background: #222;
  border: none;
  color: #fff;
  font-size: 1rem;
}
</style>
</head>

<body>
<div id="zone" onclick="tap()">
  <div id="value">0.0000</div>
</div>
<button id="reset">reset</button>

<script>
let times = [];
let signal = 0;
const ALPHA = 0.2;   // smoothing
const DECAY = 0.98;  // relax toward baseline

function tap() {
  const t = performance.now();
  times.push(t);
  if (times.length < 4) {
    render(signal *= DECAY);
    return;
  }

  // last three intervals
  const a = times[times.length - 1] - times[times.length - 2];
  const b = times[times.length - 2] - times[times.length - 3];
  const c = times[times.length - 3] - times[times.length - 4];

  // structural consistency (ratio-of-ratios)
  const r1 = a / b;
  const r2 = b / c;
  const error = Math.abs(r1 - r2);

  // smooth + decay toward zero
  signal = ALPHA * error + (1 - ALPHA) * signal;
  signal *= DECAY;

  render(signal);
}

function resetAll() {
  times = [];
  signal = 0;
  render(0);
}

function render(v) {
  document.getElementById("value").textContent =
    v.toFixed(4);
}

document.getElementById("reset").onclick = resetAll;
</script>
</body>
</html>
