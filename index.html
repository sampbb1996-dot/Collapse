<script>
/* =========================
   AUDIO â€” CONTINUOUS NOISE
   (iOS SAFE)
========================= */

let audioCtx;
let noiseSource;
let gainNode;
let audioStarted = false;

function startAudio() {
  if (audioStarted) return;
  audioStarted = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume();

  const bufferSize = audioCtx.sampleRate * 2;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);

  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }

  noiseSource = audioCtx.createBufferSource();
  noiseSource.buffer = buffer;
  noiseSource.loop = true;

  gainNode = audioCtx.createGain();
  gainNode.gain.value = 0.015;

  noiseSource.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  noiseSource.start();
}

/* =========================
   OPTIONAL: ADAPT VOLUME
========================= */

function setNoiseLevel(target) {
  if (!gainNode) return;
  gainNode.gain.value += (target - gainNode.gain.value) * 0.02;
}

/* =========================
   START ON FIRST SCREEN TAP
========================= */

window.addEventListener(
  "pointerdown",
  () => {
    startAudio();
    startGame(); // your game start
  },
  { once: true }
);
</script>
