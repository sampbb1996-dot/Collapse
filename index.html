const MAX_WINDOW = 20;

let lastTap = null;
let window = [];

function onTap(time) {
  // first tap: fabricate a zero-length interval
  if (lastTap === null) {
    lastTap = time;
    window = [0]; // seed corpus
    return {
      interval: 0,
      percent: 0
    };
  }

  const interval = time - lastTap;
  lastTap = time;

  window.push(interval);
  if (window.length > MAX_WINDOW) {
    window.shift();
  }

  if (window.length < 2) {
    return {
      interval,
      percent: 0
    };
  }

  const min = Math.min(...window);
  const max = Math.max(...window);

  if (min === max) {
    return {
      interval,
      percent: 0
    };
  }

  const percent =
    Math.min(
      100,
      Math.max(
        0,
        ((interval - min) / (max - min)) * 100
      )
    );

  return {
    interval,
    percent
  };
}
