<script>
let value = 0.5;
let lastTap = null;
let lastInterval = null;

const reader = document.getElementById("reader");
const tapBtn = document.getElementById("tapBtn");
const endBtn = document.getElementById("endBtn");

tapBtn.onclick = () => {
  const now = performance.now();

  if (lastTap !== null) {
    const interval = (now - lastTap) / 1000;

    if (lastInterval !== null) {
      const deviation = Math.abs(interval - lastInterval);

      // stability improves value, instability degrades it
      value += (0.05 - deviation) * 0.5;
    }

    lastInterval = interval;
  }

  lastTap = now;
  value = Math.max(0, Math.min(1, value));
  reader.textContent = value.toFixed(3);
};

endBtn.onclick = () => {
  value = 0.5;
  lastTap = null;
  lastInterval = null;
  reader.textContent = "0.500";
};
</script>
