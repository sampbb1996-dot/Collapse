<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Field</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #2a2a2a;
    overflow: hidden;
    touch-action: manipulation;
  }
  canvas {
    display: block;
  }
</style>
</head>

<body>
<canvas id="c"></canvas>

<script>
/* =========================
   CORE STATE
========================= */

let p = 0.5;                 // latent state
const decay = 0.0015;        // pull back to equilibrium
const noiseStrength = 0.02;  // intrinsic randomness

/* =========================
   CANVAS SETUP
========================= */

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =========================
   AUDIO (mobile-safe)
========================= */

let audioCtx = null;
let osc = null;
let gain = null;
let audioUnlocked = false;

function initAudio() {
  if (audioUnlocked) return;
  audioUnlocked = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  osc = audioCtx.createOscillator();
  gain = audioCtx.createGain();

  osc.type = "sine";
  osc.frequency.value = 220;
  gain.gain.value = 0;

  osc.connect(gain).connect(audioCtx.destination);
  osc.start();

  audioCtx.resume();
}

/* =========================
   INPUT
========================= */

document.body.addEventListener("pointerdown", () => {
  initAudio();

  // minimal, noisy influence
  p += (Math.random() - 0.5) * 0.05;
  p = Math.max(0, Math.min(1, p));
});

/* =========================
   NOISE RENDER
========================= */

function renderNoise() {
  const img = ctx.createImageData(canvas.width, canvas.height);
  const d = img.data;

  const baseR = 150 + p * 70;
  const baseG = 120 + p * 40;
  const baseB = 60  + p * 20;

  for (let i = 0; i < d.length; i += 4) {
    const n = (Math.random() - 0.5) * 40 * (0.3 + p);
    d[i]     = baseR + n;
    d[i + 1] = baseG + n;
    d[i + 2] = baseB + n;
    d[i + 3] = 255;
  }

  ctx.putImageData(img, 0, 0);
}

/* =========================
   UPDATE LOOP
========================= */

function step() {
  // intrinsic evolution
  p += (Math.random() - 0.5) * noiseStrength;
  p += (0.5 - p) * decay;
  p = Math.max(0, Math.min(1, p));

  renderNoise();

  if (audioUnlocked) {
    osc.frequency.value = 180 + p * 480;
    gain.gain.value = 0.03 + p * 0.08;
  }
}

// slow, non-informative cadence
setInterval(step, 700);
renderNoise();
</script>
</body>
</html>
