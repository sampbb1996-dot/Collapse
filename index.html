let bias = 0;           // -1 = _, 0 = balanced, +1 = A
let state = true;       // true = A present
const history = [];
const HISTORY = 10;

const NOISE = 0.05;
const DECAY = 0.04;
const THRESHOLD = 0.6;

function detectTendency() {
  if (history.length < HISTORY) return 0;

  let sum = history.reduce((a, b) => a + b, 0);
  let avg = sum / history.length;

  if (avg > 0.7) return +1;
  if (avg < 0.3) return -1;
  return 0;
}

function tick() {
  // baseline: flip state (50/50)
  state = !state;

  // record
  history.push(state ? 1 : 0);
  if (history.length > HISTORY) history.shift();

  // exploratory noise
  bias += (Math.random() - 0.5) * NOISE;

  // tendency influence
  const tendency = detectTendency();
  if (tendency === 0) {
    // no structure → decay toward balance
    bias *= (1 - DECAY);
  } else {
    bias += tendency * NOISE;
  }

  // clamp
  bias = Math.max(-1, Math.min(1, bias));

  // render decision
  if (Math.abs(bias) < THRESHOLD) {
    // balanced → follow oscillation
    square.style.display = state ? "block" : "none";
  } else {
    // biased → dominant attractor
    square.style.display = bias > 0 ? "block" : "none";
  }
}
